<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Financeiro</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #4361ee;
    --primary-light: #6f86ff;
    --primary-dark: #3040c2;
    --secondary: #3f37c9;
    --success: #4cc9f0;
    --danger: #f72585;
    --warning: #f8961e;
    --info: #4895ef;
    --light: #f8f9fa;
    --dark: #212529;
    --gray: #6c757d;
    --light-gray: #e9ecef;
    --body-bg: #f8fafc;
    --card-bg: #ffffff;
    --text-color: #333333;
    --border-radius: 12px;
    --border-radius-sm: 8px;
    --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    --transition: all 0.3s ease;
  }

  .dark-theme {
    --primary: #4cc9f0;
    --primary-light: #7ad7f7;
    --primary-dark: #2da5d1;
    --secondary: #4895ef;
    --body-bg: #121826;
    --card-bg: #1a243a;
    --text-color: #e9ecef;
    --light-gray: #2a3448;
    --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Inter', sans-serif;
    background-color: var(--body-bg);
    color: var(--text-color);
    transition: var(--transition);
    line-height: 1.6;
    min-height: 100vh;
  }

  .hidden { 
    display: none !important; 
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }

  .card {
    background: var(--card-bg);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    padding: 24px;
    transition: var(--transition);
  }

  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 16px;
    margin-bottom: 28px;
    padding: 16px 0;
  }

  h1 {
    color: var(--primary);
    font-size: 1.8rem;
    font-weight: 700;
  }

  .header-actions {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  .btn-icon {
    width: 44px;
    height: 44px;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    background-color: var(--primary);
    color: white;
  }

  .btn-icon:hover {
    opacity: 0.9;
    transform: translateY(-2px);
  }

  /* Menu Dropdown */
  .menu-container {
    position: relative;
    display: inline-block;
  }

  .menu-button {
    width: 44px;
    height: 44px;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    background-color: var(--primary);
    color: white;
  }

  .menu-button:hover {
    opacity: 0.9;
    transform: translateY(-2px);
  }

  .dropdown-menu {
    position: absolute;
    top: 100%;
    right: 0;
    background: var(--card-bg);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    padding: 8px 0;
    min-width: 200px;
    z-index: 1000;
    margin-top: 8px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: var(--transition);
  }

  .dropdown-menu.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .menu-item {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    color: var(--text-color);
    text-decoration: none;
    transition: var(--transition);
    cursor: pointer;
  }

  .menu-item:hover {
    background-color: var(--light-gray);
  }

  .menu-item i {
    margin-right: 12px;
    width: 20px;
    text-align: center;
  }

  .resumo-financeiro {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 28px;
  }

  .resumo-item {
    padding: 24px;
    border-radius: var(--border-radius);
    text-align: center;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
  }

  .resumo-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
  }

  .resumo-item:hover {
    transform: translateY(-5px);
  }

  .saldo::before { background: var(--primary); }
  .receitas::before { background: var(--success); }
  .despesas::before { background: var(--danger); }
  .parcelas::before { background: var(--info); }

  .saldo p { color: var(--primary); }
  .receitas p { color: var(--success); }
  .despesas p { color: var(--danger); }
  .parcelas p { color: var(--info); }

  .resumo-item p {
    font-size: 1.8rem;
    font-weight: 700;
  }

  .dashboard-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
  }

  @media (max-width: 900px) {
    .dashboard-content {
      grid-template-columns: 1fr;
    }
  }

  .table-container {
    overflow-x: auto;
    border-radius: var(--border-radius);
  }

  table {
    width: 100%;
    border-collapse: collapse;
    min-width: 600px;
  }

  th, td {
    padding: 16px;
    text-align: left;
  }

  th {
    background-color: var(--light-gray);
    font-weight: 600;
    font-size: 0.85rem;
    color: var(--gray);
  }

  tr {
    border-bottom: 1px solid var(--light-gray);
  }

  .receita { 
    color: var(--success);
    font-weight: 600;
  }
  
  .despesa { 
    color: var(--danger);
    font-weight: 600;
  }
  
  .btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 8px 16px;
    cursor: pointer;
    border-radius: var(--border-radius-sm);
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-weight: 500;
  }
  
  .btn:hover {
    background: var(--primary-dark);
  }
  
  .btn-danger {
    background: var(--danger);
  }
  
  .btn-danger:hover {
    background: #d1144e;
  }
  
  .btn-sm {
    padding: 6px 12px;
    font-size: 0.8rem;
  }
  
  .parcela-badge {
    background-color: var(--info);
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    margin-left: 6px;
  }

  #form-nova-transacao {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    opacity: 0;
    z-index: 1000;
    width: 90%;
    max-width: 600px;
    transition: var(--transition);
    pointer-events: none;
  }

  #form-nova-transacao.show {
    transform: translate(-50%, -50%) scale(1);
    opacity: 1;
    pointer-events: all;
  }

  .form-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
    opacity: 0;
    pointer-events: none;
    transition: var(--transition);
  }

  .form-overlay.show {
    opacity: 1;
    pointer-events: all;
  }

  .form-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--light-gray);
  }

  .form-header h2 {
    font-size: 1.4rem;
    color: var(--primary);
  }

  .close-form {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--gray);
  }

  .close-form:hover {
    color: var(--danger);
  }

  .form-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }

  @media (max-width: 600px) {
    .form-container {
      grid-template-columns: 1fr;
    }
  }

  .form-group {
    margin-bottom: 16px;
  }

  .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--gray);
  }

  input, select {
    padding: 12px 16px;
    border-radius: var(--border-radius-sm);
    border: 1px solid var(--light-gray);
    width: 100%;
    background: var(--card-bg);
    color: var(--text-color);
    transition: var(--transition);
    font-family: 'Inter', sans-serif;
  }

  input:focus, select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
  }
  
  .parcelas-group {
    grid-column: span 2;
    display: none;
    background: var(--light-gray);
    padding: 16px;
    border-radius: var(--border-radius-sm);
    margin-bottom: 16px;
  }
  
  .parcelas-group.show {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }
  
  @media (max-width: 600px) {
    .parcelas-group.show {
      grid-template-columns: 1fr;
    }
  }

  .form-buttons {
    grid-column: span 2;
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    margin-top: 16px;
  }

  @media (max-width: 600px) {
    .form-buttons {
      grid-column: span 1;
      flex-direction: column;
    }
  }

  #auth-container {
    max-width: 440px;
    margin: 0 auto;
    padding: 40px 32px;
    background: var(--card-bg);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    text-align: center;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
  }

  #auth-container h2 {
    margin-bottom: 24px;
    color: var(--primary);
  }

  .auth-form {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .input-group {
    text-align: left;
  }

  .input-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--gray);
  }

  #auth-container input {
    width: 100%;
    padding: 14px 16px;
    border-radius: var(--border-radius-sm);
    border: 1px solid var(--light-gray);
    background: var(--card-bg);
    color: var(--text-color);
  }

  #auth-container input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
  }

  #auth-container button {
    padding: 14px;
    margin-top: 8px;
    background: var(--primary);
    color: white;
    border: none;
    cursor: pointer;
    border-radius: var(--border-radius-sm);
    transition: var(--transition);
    font-weight: 500;
  }

  #auth-container button:hover {
    background: var(--primary-dark);
  }

  #auth-toggle {
    margin-top: 24px;
    cursor: pointer;
    color: var(--primary);
    text-decoration: underline;
    font-weight: 500;
  }

  .notification {
    display: none;
    padding: 12px 16px;
    margin-top: 16px;
    border-radius: var(--border-radius-sm);
    font-weight: 500;
    text-align: center;
  }

  .notification.success {
    background: var(--success);
    color: white;
  }

  .notification.error {
    background: var(--danger);
    color: white;
  }

  .grafico-container {
    height: 300px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .fab {
    position: fixed;
    bottom: 24px;
    right: 24px;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    cursor: pointer;
    transition: var(--transition);
    z-index: 99;
    border: none;
    font-size: 24px;
  }

  .fab:hover {
    transform: translateY(-3px) rotate(90deg);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
  }

  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--gray);
  }

  .empty-state i {
    font-size: 3rem;
    margin-bottom: 16px;
    color: var(--light-gray);
  }

  .empty-state p {
    font-size: 1.1rem;
    margin-bottom: 24px;
  }

  .loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s ease-in-out infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* Aba de cota√ß√µes */
  .cotacoes-container {
    display: none;
    margin-top: 24px;
  }

  .cotacoes-container.active {
    display: block;
  }

  .cotacoes-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }

  .cotacoes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 16px;
    margin-top: 16px;
  }

  .cotacao-item {
    background: var(--card-bg);
    padding: 16px;
    border-radius: var(--border-radius-sm);
    text-align: center;
    box-shadow: var(--box-shadow);
    transition: var(--transition);
  }

  .cotacao-item:hover {
    transform: translateY(-3px);
  }

  .cotacao-simbolo {
    font-size: 1.5rem;
    margin-bottom: 8px;
  }

  .cotacao-nome {
    font-size: 0.9rem;
    color: var(--gray);
    margin-bottom: 8px;
  }

  .cotacao-valor {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--primary);
  }

  .cotacao-variacao {
    font-size: 0.8rem;
    margin-top: 4px;
  }

  .cotacao-variacao.positiva {
    color: var(--success);
  }

  .cotacao-variacao.negativa {
    color: var(--danger);
  }

  .cotacao-atualizacao {
    font-size: 0.8rem;
    color: var(--gray);
    margin-top: 8px;
    text-align: center;
  }

  /* Separador entre moedas e criptomoedas */
  .cotacoes-separador {
    display: flex;
    align-items: center;
    margin: 24px 0;
    color: var(--gray);
  }

  .cotacoes-separador::before,
  .cotacoes-separador::after {
    content: "";
    flex: 1;
    height: 1px;
    background-color: var(--light-gray);
  }

  .cotacoes-separador-texto {
    padding: 0 16px;
    font-weight: 600;
    font-size: 0.9rem;
  }

  /* Configura√ß√µes de notifica√ß√£o */
  .configuracoes-notificacoes {
    display: none;
    margin-top: 24px;
  }

  .configuracoes-notificacoes.active {
    display: block;
  }

  .config-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    border-bottom: 1px solid var(--light-gray);
  }

  .config-item:last-child {
    border-bottom: none;
  }

  .config-info {
    flex: 1;
  }

  .config-titulo {
    font-weight: 600;
    margin-bottom: 4px;
  }

  .config-descricao {
    font-size: 0.9rem;
    color: var(--gray);
  }

  .switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
  }

  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--light-gray);
    transition: .4s;
    border-radius: 24px;
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
  }

  input:checked + .slider {
    background-color: var(--primary);
  }

  input:checked + .slider:before {
    transform: translateX(26px);
  }

  /* Calculadora de Juros */
  .calculadora-juros {
    display: none;
    margin-top: 24px;
  }

  .calculadora-juros.active {
    display: block;
  }

  .calculadora-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 16px;
  }

  @media (max-width: 768px) {
    .calculadora-grid {
      grid-template-columns: 1fr;
    }
  }

  .calculadora-inputs {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .calculadora-resultados {
    background-color: var(--light-gray);
    padding: 20px;
    border-radius: var(--border-radius-sm);
  }

  .resultado-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 12px;
    padding-bottom: 12px;
    border-bottom: 1px solid rgba(0,0,0,0.1);
  }

  .resultado-item:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
    font-weight: 700;
    font-size: 1.1rem;
    color: var(--primary);
  }

  .resultado-valor {
    font-weight: 600;
  }

  @media (max-width: 768px) {
    .container {
      padding: 16px;
    }
    
    header {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .header-actions {
      width: 100%;
      justify-content: space-between;
      margin-top: 16px;
    }
    
    .resumo-financeiro {
      grid-template-columns: 1fr;
    }
    
    .resumo-item p {
      font-size: 1.5rem;
    }
    
    .card {
      padding: 20px;
    }

    .cotacoes-grid {
      grid-template-columns: 1fr 1fr;
    }

    .dropdown-menu {
      right: auto;
      left: 0;
    }
  }

  @media (max-width: 480px) {
    h1 {
      font-size: 1.5rem;
    }
    
    .btn-icon, .menu-button {
      width: 40px;
      height: 40px;
    }
    
    .form-container {
      gap: 12px;
    }
    
    .form-group {
      margin-bottom: 12px;
    }

    .cotacoes-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>

<div class="form-overlay" id="form-overlay"></div>

<div id="auth-container">
  <h2 id="auth-title">Registrar</h2>
  <div class="auth-form">
    <div class="input-group">
      <label for="auth-email">Email</label>
      <input type="email" id="auth-email" placeholder="Seu email">
    </div>
    <div class="input-group">
      <label for="auth-password">Senha</label>
      <input type="password" id="auth-password" placeholder="Sua senha">
    </div>
    <button id="auth-button">Registrar</button>
  </div>
  <p id="auth-toggle">J√° tem conta? Entrar</p>
  <div id="notification" class="notification"></div>
</div>

<div class="container hidden" id="dashboard">
  <header>
    <h1>Dashboard Financeiro</h1>
    <div class="header-actions">
      <button class="btn-icon" id="theme-toggle" title="Alterar tema"><i class="fas fa-moon"></i></button>
      
      <!-- Menu Dropdown -->
      <div class="menu-container">
        <button class="menu-button" id="menu-button" title="Menu">
          <i class="fas fa-bars"></i>
        </button>
        <div class="dropdown-menu" id="dropdown-menu">
          <div class="menu-item" data-action="pdf">
            <i class="fas fa-file-pdf"></i> Gerar PDF
          </div>
          <div class="menu-item" data-action="cotacoes">
            <i class="fas fa-coins"></i> Cota√ß√µes
          </div>
          <div class="menu-item" data-action="calculadora">
            <i class="fas fa-calculator"></i> Calculadora
          </div>
          <div class="menu-item" data-action="notificacoes">
            <i class="fas fa-bell"></i> Notifica√ß√µes
          </div>
          <div class="menu-item" data-action="logout">
            <i class="fas fa-sign-out-alt"></i> Sair
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="resumo-financeiro">
    <div class="resumo-item saldo card">
      <h3>Saldo Atual</h3>
      <p id="saldo-atual">R$0,00</p>
    </div>
    <div class="resumo-item receitas card">
      <h3>Receitas</h3>
      <p id="total-receitas">R$0,00</p>
    </div>
    <div class="resumo-item despesas card">
      <h3>Despesas</h3>
      <p id="total-despesas">R$0,00</p>
    </div>
    <div class="resumo-item parcelas card">
      <h3>Parcelas em Andamento</h3>
      <p id="total-parcelas">R$0,00</p>
    </div>
  </div>

  <div class="dashboard-content">
    <div class="card grafico-container">
      <canvas id="grafico-financeiro"></canvas>
    </div>
    
    <div class="card">
      <h3 style="margin-bottom: 16px;">√öltimas Transa√ß√µes</h3>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Data</th>
              <th>Descri√ß√£o</th>
              <th>Valor</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="corpo-tabela">
            <tr>
              <td colspan="4" style="text-align: center;">
                <div class="empty-state">
                  <i class="fas fa-receipt"></i>
                  <p>Nenhuma transa√ß√£o encontrada</p>
                  <button class="btn" id="btn-add-first"><i class="fas fa-plus"></i> Adicionar Transa√ß√£o</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- √Årea de Cota√ß√µes -->
  <div class="card cotacoes-container" id="cotacoes-container">
    <div class="cotacoes-header">
      <h3 style="margin-bottom: 0;">Cota√ß√µes de Moedas</h3>
      <button class="btn btn-sm" id="btn-atualizar-cotacoes">
        <i class="fas fa-sync-alt"></i> Atualizar
      </button>
    </div>
    <div class="cotacoes-grid" id="cotacoes-grid">
      <!-- Moedas convencionais -->
      <div class="cotacao-item">
        <div class="cotacao-simbolo">üíµ</div>
        <div class="cotacao-nome">D√≥lar Americano (USD)</div>
        <div class="cotacao-valor">Carregando...</div>
        <div class="cotacao-variacao">-</div>
      </div>
      <div class="cotacao-item">
        <div class="cotacao-simbolo">üí∂</div>
        <div class="cotacao-nome">Euro (EUR)</div>
        <div class="cotacao-valor">Carregando...</div>
        <div class="cotacao-variacao">-</div>
      </div>
      <div class="cotacao-item">
        <div class="cotacao-simbolo">üí∑</div>
        <div class="cotacao-nome">Libra Esterlina (GBP)</div>
        <div class="cotacao-valor">Carregando...</div>
        <div class="cotacao-variacao">-</div>
      </div>
      <div class="cotacao-item">
        <div class="cotacao-simbolo">üí¥</div>
        <div class="cotacao-nome">Iene Japon√™s (JPY)</div>
        <div class="cotacao-valor">Carregando...</div>
        <div class="cotacao-variacao">-</div>
      </div>
    </div>
    
    <!-- Separador entre moedas e criptomoedas -->
    <div class="cotacoes-separador">
      <span class="cotacoes-separador-texto">Criptomoedas</span>
    </div>
    
    <div class="cotacoes-grid" id="cotacoes-cripto-grid">
      <!-- Criptomoedas adicionadas -->
      <div class="cotacao-item">
        <div class="cotacao-simbolo">‚Çø</div>
        <div class="cotacao-nome">Bitcoin (BTC)</div>
        <div class="cotacao-valor">Carregando...</div>
        <div class="cotacao-variacao">-</div>
      </div>
      <div class="cotacao-item">
        <div class="cotacao-simbolo">‚ü†</div>
        <div class="cotacao-nome">Ethereum (ETH)</div>
        <div class="cotacao-valor">Carregando...</div>
        <div class="cotacao-variacao">-</div>
      </div>
      <div class="cotacao-item">
        <div class="cotacao-simbolo">‚óà</div>
        <div class="cotacao-nome">Binance Coin (BNB)</div>
        <div class="cotacao-valor">Carregando...</div>
        <div class="cotacao-variacao">-</div>
      </div>
      <div class="cotacao-item">
        <div class="cotacao-simbolo">∆â</div>
        <div class="cotacao-nome">Dogecoin (DOGE)</div>
        <div class="cotacao-valor">Carregando...</div>
        <div class="cotacao-variacao">-</div>
      </div>
    </div>
    <div class="cotacao-atualizacao" id="cotacao-atualizacao">
      √öltima atualiza√ß√£o: Carregando...
    </div>
  </div>

  <!-- Calculadora de Juros -->
  <div class="card calculadora-juros" id="calculadora-juros">
    <h3 style="margin-bottom: 16px;">Calculadora de Juros Compostos</h3>
    <div class="calculadora-grid">
      <div class="calculadora-inputs">
        <div class="form-group">
          <label for="valor-inicial">Valor Inicial (R$)</label>
          <input type="number" id="valor-inicial" placeholder="0,00" step="0.01" min="0" value="1000">
        </div>
        <div class="form-group">
          <label for="taxa-juros">Taxa de Juros (% ao m√™s)</label>
          <input type="number" id="taxa-juros" placeholder="0,00" step="0.01" min="0" value="1">
        </div>
        <div class="form-group">
          <label for="periodo">Per√≠odo (meses)</label>
          <input type="number" id="periodo" placeholder="0" min="1" value="12">
        </div>
        <div class="form-group">
          <label for="aporte-mensal">Aporte Mensal (R$)</label>
          <input type="number" id="aporte-mensal" placeholder="0,00" step="0.01" min="0" value="100">
        </div>
        <button class="btn" id="btn-calcular-juros">
          <i class="fas fa-calculator"></i> Calcular
        </button>
      </div>
      <div class="calculadora-resultados">
        <h4 style="margin-bottom: 16px; text-align: center;">Resultado</h4>
        <div class="resultado-item">
          <span>Valor Investido:</span>
          <span class="resultado-valor" id="total-investido">R$ 0,00</span>
        </div>
        <div class="resultado-item">
          <span>Juros Acumulados:</span>
          <span class="resultado-valor" id="juros-acumulados">R$ 0,00</span>
        </div>
        <div class="resultado-item">
          <span>Valor Final:</span>
          <span class="resultado-valor" id="valor-final">R$ 0,00</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Configura√ß√µes de Notifica√ß√£o -->
  <div class="card configuracoes-notificacoes" id="configuracoes-notificacoes">
    <h3 style="margin-bottom: 16px;">Configura√ß√µes de Notifica√ß√£o</h3>
    <div class="config-item">
      <div class="config-info">
        <div class="config-titulo">Notifica√ß√µes Gerais</div>
        <div class="config-descricao">Ativar/desativar todas as notifica√ß√µes</div>
      </div>
      <label class="switch">
        <input type="checkbox" id="notificacoes-gerais">
        <span class="slider"></span>
      </label>
    </div>
    <div class="config-item">
      <div class="config-info">
        <div class="config-titulo">Notifica√ß√£o de Vencimentos</div>
        <div class="config-descricao">Alertas sobre parcelas pr√≥ximas do vencimento</div>
      </div>
      <label class="switch">
        <input type="checkbox" id="notificacoes-vencimentos">
        <span class="slider"></span>
      </label>
    </div>
    <div class="config-item">
      <div class="config-info">
        <div class="config-titulo">Notifica√ß√£o de Metas</div>
        <div class="config-descricao">Alertas sobre o progresso das metas financeiras</div>
      </div>
      <label class="switch">
        <input type="checkbox" id="notificacoes-metas">
        <span class="slider"></span>
      </label>
    </div>
    <div class="config-item">
      <div class="config-info">
        <div class="config-titulo">Notifica√ß√£o de Cota√ß√µes</div>
        <div class="config-descricao">Alertas sobre varia√ß√µes significativas nas cota√ß√µes</div>
      </div>
      <label class="switch">
        <input type="checkbox" id="notificacoes-cotacoes">
        <span class="slider"></span>
      </label>
    </div>
    <button class="btn" id="btn-salvar-configuracoes" style="margin-top: 16px;">
      <i class="fas fa-save"></i> Salvar Configura√ß√µes
    </button>
  </div>

  <div class="card" id="form-nova-transacao">
    <div class="form-header">
      <h2>Nova Transa√ß√£o</h2>
      <button class="close-form" id="close-form"><i class="fas fa-times"></i></button>
    </div>
    <form id="form-transacao">
      <div class="form-container">
        <div class="form-group">
          <label for="data">Data</label>
          <input type="date" id="data" required>
        </div>
        <div class="form-group">
          <label for="descricao">Descri√ß√£o</label>
          <input type="text" id="descricao" placeholder="Descri√ß√£o da transa√ß√£o" required>
        </div>
        <div class="form-group">
          <label for="categoria">Categoria</label>
          <input type="text" id="categoria" placeholder="Categoria" required>
        </div>
        <div class="form-group">
          <label for="valor">Valor (R$)</label>
          <input type="number" id="valor" placeholder="0,00" step="0.01" min="0" required>
        </div>
        <div class="form-group">
          <label for="tipo">Tipo</label>
          <select id="tipo" required>
            <option value="receita">Receita</option>
            <option value="despesa">Despesa</option>
          </select>
        </div>
        
        <div class="parcelas-group" id="parcelas-group">
          <div class="form-group">
            <label for="parcelas">N√∫mero de Parcelas</label>
            <input type="number" id="parcelas" min="1" max="36" value="1">
          </div>
          <div class="form-group">
            <label for="intervalo">Intervalo (dias)</label>
            <input type="number" id="intervalo" min="1" max="90" value="30">
          </div>
        </div>
      </div>
      <div class="form-buttons">
        <button type="button" class="btn" id="cancelar-transacao">
          <i class="fas fa-times"></i> Cancelar
        </button>
        <button type="submit" class="btn">
          <i class="fas fa-check"></i> Adicionar
        </button>
      </div>
    </form>
  </div>

  <button class="fab hidden" id="fab-add" title="Adicionar transa√ß√£o">
    <i class="fas fa-plus"></i>
  </button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyAh6NmfvbT3zFZDuJAAH7fG-0qBFzR3pMc",
  authDomain: "guga-b7022.firebaseapp.com",
  databaseURL: "https://guga-b7022-default-rtdb.firebaseio.com",
  projectId: "guga-b7022",
  storageBucket: "guga-b7022.firebasestorage.app",
  messagingSenderId: "730764999252",
  appId: "1:730764999252:web:31c9506021dad2604e8bc1",
  measurementId: "G-XRLME6Y4QH"
};

// Inicializa√ß√£o do Firebase
const app = initializeApp(firebaseConfig);
const database = getDatabase(app);
const auth = getAuth(app);
const transacoesRef = ref(database, 'transacoes');

// Refer√™ncias DOM
const authContainer = document.getElementById('auth-container');
const dashboard = document.getElementById('dashboard');
const authTitle = document.getElementById('auth-title');
const authButton = document.getElementById('auth-button');
const authToggle = document.getElementById('auth-toggle');
const authEmail = document.getElementById('auth-email');
const authPassword = document.getElementById('auth-password');
const notification = document.getElementById('notification');
const themeToggle = document.getElementById('theme-toggle');
const formNova = document.getElementById('form-nova-transacao');
const formOverlay = document.getElementById('form-overlay');
const cancelarTrans = document.getElementById('cancelar-transacao');
const closeForm = document.getElementById('close-form');
const fabAdd = document.getElementById('fab-add');
const btnAddFirst = document.getElementById('btn-add-first');
const tipoSelect = document.getElementById('tipo');
const parcelasGroup = document.getElementById('parcelas-group');
const cotacoesContainer = document.getElementById('cotacoes-container');
const configuracoesNotificacoes = document.getElementById('configuracoes-notificacoes');
const cotacoesGrid = document.getElementById('cotacoes-grid');
const cotacoesCriptoGrid = document.getElementById('cotacoes-cripto-grid');
const cotacaoAtualizacao = document.getElementById('cotacao-atualizacao');
const btnSalvarConfiguracoes = document.getElementById('btn-salvar-configuracoes');
const btnAtualizarCotacoes = document.getElementById('btn-atualizar-cotacoes');
const calculadoraJuros = document.getElementById('calculadora-juros');
const btnCalcularJuros = document.getElementById('btn-calcular-juros');

// Menu Dropdown
const menuButton = document.getElementById('menu-button');
const dropdownMenu = document.getElementById('dropdown-menu');
const menuItems = document.querySelectorAll('.menu-item');

// Vari√°veis globais
let todasTransacoes = [];
let grafico = null;
let currentUser = null;
let isRegister = true;
let transacoesParceladas = [];
let ultimaAtualizacaoCotacoes = null;

// Tema escuro/claro
const savedTheme = localStorage.getItem('theme');
if (savedTheme === 'dark') {
  document.body.classList.add('dark-theme');
  themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
}

themeToggle.addEventListener('click', () => {
  document.body.classList.toggle('dark-theme');
  if (document.body.classList.contains('dark-theme')) {
    localStorage.setItem('theme', 'dark');
    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
  } else {
    localStorage.setItem('theme', 'light');
    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
  }
});

// Menu Dropdown - Abrir/Fechar
menuButton.addEventListener('click', (e) => {
  e.stopPropagation();
  dropdownMenu.classList.toggle('show');
});

// Fechar menu ao clicar fora dele
document.addEventListener('click', (e) => {
  if (!menuButton.contains(e.target) && !dropdownMenu.contains(e.target)) {
    dropdownMenu.classList.remove('show');
  }
});

// A√ß√µes do menu
menuItems.forEach(item => {
  item.addEventListener('click', () => {
    const action = item.getAttribute('data-action');
    dropdownMenu.classList.remove('show');
    
    switch(action) {
      case 'pdf':
        gerarPDF();
        break;
      case 'cotacoes':
        abrirCotacoes();
        break;
      case 'calculadora':
        abrirCalculadora();
        break;
      case 'notificacoes':
        abrirNotificacoes();
        break;
      case 'logout':
        fazerLogout();
        break;
    }
  });
});

function abrirCotacoes() {
  cotacoesContainer.classList.add('active');
  configuracoesNotificacoes.classList.remove('active');
  calculadoraJuros.classList.remove('active');
  carregarCotacoesMoedas();
}

function abrirCalculadora() {
  calculadoraJuros.classList.add('active');
  cotacoesContainer.classList.remove('active');
  configuracoesNotificacoes.classList.remove('active');
  calcularJuros(); // Calcular automaticamente ao abrir
}

function abrirNotificacoes() {
  configuracoesNotificacoes.classList.add('active');
  cotacoesContainer.classList.remove('active');
  calculadoraJuros.classList.remove('active');
  carregarConfiguracoesNotificacoes();
}

async function fazerLogout() {
  if (confirm('Deseja realmente sair?')) {
    try {
      await signOut(auth);
      showNotification('Usu√°rio deslogado com sucesso!');
    } catch (error) {
      showNotification('Erro ao fazer logout', false);
    }
  }
}

// Bot√£o para atualizar cota√ß√µes manualmente
btnAtualizarCotacoes.addEventListener('click', () => {
  carregarCotacoesMoedas();
});

// Alternar entre login/registro
authToggle.addEventListener('click', () => {
  isRegister = !isRegister;
  authTitle.textContent = isRegister ? "Registrar" : "Entrar";
  authButton.textContent = isRegister ? "Registrar" : "Entrar";
  authToggle.textContent = isRegister ? "J√° tem conta? Entrar" : "N√£o tem conta? Registrar";
  authEmail.value = '';
  authPassword.value = '';
  notification.style.display = 'none';
});

// Mostrar/ocultar op√ß√µes de parcelamento
tipoSelect.addEventListener('change', () => {
  parcelasGroup.classList.toggle('show', tipoSelect.value === 'despesa');
});

// Notifica√ß√£o
function showNotification(msg, isSuccess = true) {
  notification.textContent = msg;
  notification.className = `notification ${isSuccess ? 'success' : 'error'}`;
  notification.style.display = 'block';
  setTimeout(() => notification.style.display = 'none', 3000);
}

// Registrar/Login
authButton.addEventListener('click', async () => {
  const email = authEmail.value.trim();
  const password = authPassword.value.trim();
  
  if (!email || !password) {
    showNotification('Preencha todos os campos', false);
    return;
  }
  
  if (isRegister && password.length < 6) { 
    showNotification('Senha m√≠nima: 6 caracteres', false); 
    return; 
  }
  
  authButton.innerHTML = isRegister ? '<div class="loading"></div> Registrando...' : '<div class="loading"></div> Entrando...';
  
  try {
    if (isRegister) {
      await createUserWithEmailAndPassword(auth, email, password);
    } else {
      await signInWithEmailAndPassword(auth, email, password);
    }
    showNotification(isRegister ? 'Registrado com sucesso!' : 'Login realizado!');
    authEmail.value = '';
    authPassword.value = '';
  } catch (err) { 
    showNotification(err.message, false);
  } finally {
    authButton.innerHTML = isRegister ? "Registrar" : "Entrar";
  }
});

// Monitorar estado de autentica√ß√£o
onAuthStateChanged(auth, (user) => {
  currentUser = user;
  if (user) {
    authContainer.classList.add('hidden');
    dashboard.classList.remove('hidden');
    fabAdd.classList.remove('hidden');
    carregarTransacoes();
  } else {
    authContainer.classList.remove('hidden');
    dashboard.classList.add('hidden');
    fabAdd.classList.add('hidden');
    todasTransacoes = [];
    atualizarDashboard();
  }
});

// Carregar transa√ß√µes
function carregarTransacoes() {
  onValue(transacoesRef, (snapshot) => {
    const dados = snapshot.val() || {};
    todasTransacoes = Object.entries(dados).map(([id, t]) => ({id, ...t}));
    
    // Filtrar transa√ß√µes parceladas em andamento
    transacoesParceladas = todasTransacoes.filter(t => 
      t.parcelaAtual && t.totalParcelas && parseInt(t.parcelaAtual) < parseInt(t.totalParcelas)
    );
    
    atualizarDashboard();
  });
}

// Atualizar dashboard
function atualizarDashboard() {
  const saldo = todasTransacoes.reduce((s, t) => t.tipo === 'receita' ? s + parseFloat(t.valor) : s - parseFloat(t.valor), 0);
  const totalReceitas = todasTransacoes.filter(t => t.tipo === 'receita').reduce((s, t) => s + parseFloat(t.valor), 0);
  const totalDespesas = todasTransacoes.filter(t => t.tipo === 'despesa').reduce((s, t) => s + parseFloat(t.valor), 0);
  
  // Calcular valor total das parcelas em andamento
  const totalParcelas = transacoesParceladas.reduce((total, t) => {
    const parcelasRestantes = parseInt(t.totalParcelas) - parseInt(t.parcelaAtual);
    const valorParcela = parseFloat(t.valor);
    return total + (valorParcela * parcelasRestantes);
  }, 0);

  document.getElementById('saldo-atual').textContent = saldo.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'});
  document.getElementById('total-receitas').textContent = totalReceitas.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'});
  document.getElementById('total-despesas').textContent = totalDespesas.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'});
  document.getElementById('total-parcelas').textContent = totalParcelas.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'});

  const tbody = document.getElementById('corpo-tabela'); 
  
  if (todasTransacoes.length === 0) {
    tbody.innerHTML = `
      <tr>
        <td colspan="4" style="text-align: center;">
          <div class="empty-state">
            <i class="fas fa-receipt"></i>
            <p>Nenhuma transa√ß√£o encontrada</p>
            <button class="btn" id="btn-add-first"><i class="fas fa-plus"></i> Adicionar Transa√ß√£o</button>
          </div>
        </td>
      </tr>`;
    document.getElementById('btn-add-first').addEventListener('click', showForm);
  } else {
    const transacoesOrdenadas = [...todasTransacoes].sort((a, b) => new Date(b.data) - new Date(a.data));
    const ultimasTransacoes = transacoesOrdenadas.slice(0, 5);
    
    tbody.innerHTML = ultimasTransacoes.map(t => {
      const dataFormat = new Date(t.data).toLocaleDateString('pt-BR');
      const valorExibido = t.tipo === 'despesa' ? -Math.abs(parseFloat(t.valor)) : parseFloat(t.valor);
      const descricaoCompleta = t.parcelaAtual && t.totalParcelas 
        ? `${t.descricao} <span class="parcela-badge">${t.parcelaAtual}/${t.totalParcelas}</span>` 
        : t.descricao;
      
      return `
        <tr>
          <td>${dataFormat}</td>
          <td>${descricaoCompleta}</td>
          <td class="${t.tipo === 'receita' ? 'receita' : 'despesa'}">
            ${valorExibido.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'})}
          </td>
          <td>
            <button class="btn btn-danger excluir" data-id="${t.id}">
              <i class="fas fa-trash"></i> Excluir
            </button>
          </td>
        </tr>
      `;
    }).join('');
    
    document.querySelectorAll('.excluir').forEach(btn => {
      btn.addEventListener('click', async e => {
        const id = e.currentTarget.getAttribute('data-id');
        if (confirm('Deseja excluir esta transa√ß√£o?')) {
          try {
            await remove(ref(database, `transacoes/${id}`));
            showNotification('Transa√ß√£o exclu√≠da com sucesso!');
          } catch (error) {
            showNotification('Erro ao excluir transa√ß√£o', false);
          }
        }
      });
    });
  }

  const ctx = document.getElementById('grafico-financeiro').getContext('2d');
  if (grafico) grafico.destroy();
  
  grafico = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['Receitas', 'Despesas'],
      datasets: [{
        data: [totalReceitas, totalDespesas],
        backgroundColor: ['#4cc9f0', '#f72585'],
        borderWidth: 0,
        hoverOffset: 10
      }]
    }, 
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '70%',
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            font: {
              family: "'Inter', sans-serif"
            },
            padding: 20
          }
        }
      }
    }
  });
}

// Carregar cota√ß√µes de moedas e criptomoedas
async function carregarCotacoesMoedas() {
  try {
    // Verificar se j√° temos cota√ß√µes salvas e se s√£o do dia atual
    const hoje = new Date().toDateString();
    const cotacoesSalvas = localStorage.getItem('cotacoesMoedas');
    const dataCotacoesSalvas = localStorage.getItem('dataCotacoes');
    
    if (cotacoesSalvas && dataCotacoesSalvas === hoje) {
      // Usar cota√ß√µes salvas se forem do dia atual
      const cotacoes = JSON.parse(cotacoesSalvas);
      exibirCotacoes(cotacoes);
      return;
    }
    
    // Mostrar estado de carregamento
    cotacoesGrid.innerHTML = `
      <div class="empty-state">
        <div class="loading"></div>
        <p>Carregando cota√ß√µes...</p>
      </div>
    `;
    
    // Valores base para moedas tradicionais
    const valoresBase = {
      USD: 5.45,
      EUR: 6.20,
      GBP: 7.10,
      JPY: 0.041
    };
    
    // Valores base para criptomoedas (em reais)
    const valoresBaseCripto = {
      BTC: 320000,
      ETH: 18000,
      BNB: 1800,
      DOGE: 0.40
    };
    
    // Simular uma pequena varia√ß√£o di√°ria para moedas tradicionais
    const cotacoesMoedas = [
      { 
        moeda: "USD", 
        nome: "D√≥lar Americano", 
        valor: valoresBase.USD * (0.995 + Math.random() * 0.01),
        variacao: (Math.random() - 0.5) * 2,
        tipo: "moeda"
      },
      { 
        moeda: "EUR", 
        nome: "Euro", 
        valor: valoresBase.EUR * (0.995 + Math.random() * 0.01),
        variacao: (Math.random() - 0.5) * 1.5,
        tipo: "moeda"
      },
      { 
        moeda: "GBP", 
        nome: "Libra Esterlina", 
        valor: valoresBase.GBP * (0.995 + Math.random() * 0.01),
        variacao: (Math.random() - 0.5) * 1.8,
        tipo: "moeda"
      },
      { 
        moeda: "JPY", 
        nome: "Iene Japon√™s", 
        valor: valoresBase.JPY * (0.995 + Math.random() * 0.01),
        variacao: (Math.random() - 0.5) * 2.2,
        tipo: "moeda"
      }
    ];
    
    // Simular uma pequena varia√ß√£o di√°ria para criptomoedas (mais vol√°teis)
    const cotacoesCripto = [
      { 
        moeda: "BTC", 
        nome: "Bitcoin", 
        valor: valoresBaseCripto.BTC * (0.98 + Math.random() * 0.04),
        variacao: (Math.random() - 0.5) * 10,
        tipo: "cripto"
      },
      { 
        moeda: "ETH", 
        nome: "Ethereum", 
        valor: valoresBaseCripto.ETH * (0.98 + Math.random() * 0.04),
        variacao: (Math.random() - 0.5) * 8,
        tipo: "cripto"
      },
      { 
        moeda: "BNB", 
        nome: "Binance Coin", 
        valor: valoresBaseCripto.BNB * (0.98 + Math.random() * 0.04),
        variacao: (Math.random() - 0.5) * 7,
        tipo: "cripto"
      },
      { 
        moeda: "DOGE", 
        nome: "Dogecoin", 
        valor: valoresBaseCripto.DOGE * (0.95 + Math.random() * 0.1),
        variacao: (Math.random() - 0.5) * 15,
        tipo: "cripto"
      }
    ];
    
    // Combinar todas as cota√ß√µes
    const todasCotacoes = [...cotacoesMoedas, ...cotacoesCripto];
    
    // Salvar no localStorage para uso posterior no mesmo dia
    localStorage.setItem('cotacoesMoedas', JSON.stringify(todasCotacoes));
    localStorage.setItem('dataCotacoes', hoje);
    
    // Exibir as cota√ß√µes
    exibirCotacoes(todasCotacoes);
    
  } catch (error) {
    cotacoesGrid.innerHTML = `
      <div class="empty-state">
        <i class="fas fa-exclamation-triangle"></i>
        <p>Erro ao carregar cota√ß√µes</p>
        <button class="btn btn-sm" id="retry-cotacoes">
          <i class="fas fa-redo"></i> Tentar Novamente
        </button>
      </div>
    `;
    
    document.getElementById('retry-cotacoes').addEventListener('click', carregarCotacoesMoedas);
  }
}

// Exibir cota√ß√µes na interface
function exibirCotacoes(cotacoes) {
  // Separar moedas tradicionais e criptomoedas
  const moedasTradicionais = cotacoes.filter(c => c.tipo === "moeda");
  const criptomoedas = cotacoes.filter(c => c.tipo === "cripto");
  
  // Exibir moedas tradicionais
  cotacoesGrid.innerHTML = moedasTradicionais.map(cotacao => {
    const variacaoClass = cotacao.variacao >= 0 ? 'positiva' : 'negativa';
    const variacaoSinal = cotacao.variacao >= 0 ? '+' : '';
    
    // Definir s√≠mbolos
    const simbolo = cotacao.moeda === 'USD' ? 'üíµ' : cotacao.moeda === 'EUR' ? 'üí∂' : cotacao.moeda === 'GBP' ? 'üí∑' : 'üí¥';
    
    return `
      <div class="cotacao-item">
        <div class="cotacao-simbolo">${simbolo}</div>
        <div class="cotacao-nome">${cotacao.nome} (${cotacao.moeda})</div>
        <div class="cotacao-valor">R$ ${cotacao.valor.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
        <div class="cotacao-variacao ${variacaoClass}">
          ${variacaoSinal}${cotacao.variacao.toFixed(2)}%
        </div>
      </div>
    `;
  }).join('');
  
  // Exibir criptomoedas
  cotacoesCriptoGrid.innerHTML = criptomoedas.map(cotacao => {
    const variacaoClass = cotacao.variacao >= 0 ? 'positiva' : 'negativa';
    const variacaoSinal = cotacao.variacao >= 0 ? '+' : '';
    
    // Definir s√≠mbolos
    const simbolo = cotacao.moeda === 'BTC' ? '‚Çø' : cotacao.moeda === 'ETH' ? '‚ü†' : cotacao.moeda === 'BNB' ? '‚óà' : '∆â';
    
    return `
      <div class="cotacao-item">
        <div class="cotacao-simbolo">${simbolo}</div>
        <div class="cotacao-nome">${cotacao.nome} (${cotacao.moeda})</div>
        <div class="cotacao-valor">R$ ${cotacao.valor.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
        <div class="cotacao-variacao ${variacaoClass}">
          ${variacaoSinal}${cotacao.variacao.toFixed(2)}%
        </div>
      </div>
    `;
  }).join('');
  
  // Atualizar informa√ß√£o da √∫ltima atualiza√ß√£o
  const agora = new Date();
  ultimaAtualizacaoCotacoes = agora;
  cotacaoAtualizacao.textContent = `√öltima atualiza√ß√£o: ${agora.toLocaleString('pt-BR')}`;
}

// Calculadora de juros compostos
function calcularJuros() {
  const valorInicial = parseFloat(document.getElementById('valor-inicial').value) || 0;
  const taxaJuros = parseFloat(document.getElementById('taxa-juros').value) || 0;
  const periodo = parseInt(document.getElementById('periodo').value) || 0;
  const aporteMensal = parseFloat(document.getElementById('aporte-mensal').value) || 0;
  
  if (valorInicial <= 0 || periodo <= 0) {
    showNotification('Valor inicial e per√≠odo devem ser maiores que zero', false);
    return;
  }
  
  let valorFinal = valorInicial;
  let totalInvestido = valorInicial;
  
  for (let i = 0; i < periodo; i++) {
    // Adiciona aporte mensal no in√≠cio de cada per√≠odo (exceto o primeiro m√™s)
    if (i > 0) {
      valorFinal += aporteMensal;
      totalInvestido += aporteMensal;
    }
    
    // Aplica juros
    valorFinal *= (1 + (taxaJuros / 100));
  }
  
  const jurosAcumulados = valorFinal - totalInvestido;
  
  // Exibir resultados
  document.getElementById('total-investido').textContent = totalInvestido.toLocaleString('pt-BR', {
    style: 'currency',
    currency: 'BRL'
  });
  
  document.getElementById('juros-acumulados').textContent = jurosAcumulados.toLocaleString('pt-BR', {
    style: 'currency',
    currency: 'BRL'
  });
  
  document.getElementById('valor-final').textContent = valorFinal.toLocaleString('pt-BR', {
    style: 'currency',
    currency: 'BRL'
  });
}

// Event listener para o bot√£o de calcular juros
btnCalcularJuros.addEventListener('click', calcularJuros);

// Carregar configura√ß√µes de notifica√ß√£o
function carregarConfiguracoesNotificacoes() {
  const configs = JSON.parse(localStorage.getItem('configuracoesNotificacoes')) || {
    gerais: true,
    vencimentos: true,
    metas: false,
    cotacoes: false
  };
  
  document.getElementById('notificacoes-gerais').checked = configs.gerais;
  document.getElementById('notificacoes-vencimentos').checked = configs.vencimentos;
  document.getElementById('notificacoes-metas').checked = configs.metas;
  document.getElementById('notificacoes-cotacoes').checked = configs.cotacoes;
}

// Salvar configura√ß√µes de notifica√ß√£o
btnSalvarConfiguracoes.addEventListener('click', () => {
  const configs = {
    gerais: document.getElementById('notificacoes-gerais').checked,
    vencimentos: document.getElementById('notificacoes-vencimentos').checked,
    metas: document.getElementById('notificacoes-metas').checked,
    cotacoes: document.getElementById('notificacoes-cotacoes').checked
  };
  
  localStorage.setItem('configuracoesNotificacoes', JSON.stringify(configs));
  showNotification('Configura√ß√µes salvas com sucesso!');
});

// Verificar diariamente se as cota√ß√µes precisam ser atualizadas
function verificarAtualizacaoDiaria() {
  const hoje = new Date().toDateString();
  const dataUltimaVerificacao = localStorage.getItem('dataUltimaVerificacaoCotacoes');
  
  if (dataUltimaVerificacao !== hoje) {
    // √â um novo dia, for√ßar atualiza√ß√£o das cota√ß√µes
    localStorage.setItem('dataUltimaVerificacaoCotacoes', hoje);
    
    // Se a aba de cota√ß√µes estiver vis√≠vel, atualizar
    if (cotacoesContainer.classList.contains('active')) {
      carregarCotacoesMoedas();
    }
  }
}

// Verificar a cada hora se precisa atualizar
setInterval(verificarAtualizacaoDiaria, 60 * 60 * 1000); // 1 hora

// Mostrar/ocultar formul√°rio
function showForm() {
  formNova.classList.add('show');
  formOverlay.classList.add('show');
  document.body.style.overflow = 'hidden';
}

function hideForm() {
  formNova.classList.remove('show');
  formOverlay.classList.remove('show');
  document.body.style.overflow = 'auto';
  parcelasGroup.classList.remove('show');
}

// Event listeners para formul√°rio
fabAdd.addEventListener('click', showForm);
btnAddFirst && btnAddFirst.addEventListener('click', showForm);
formOverlay.addEventListener('click', hideForm);
cancelarTrans.addEventListener('click', hideForm);
closeForm.addEventListener('click', hideForm);

// Adicionar transa√ß√£o
document.getElementById('form-transacao').addEventListener('submit', async e => {
  e.preventDefault();
  const data = document.getElementById('data').value;
  const descricao = document.getElementById('descricao').value;
  const categoria = document.getElementById('categoria').value;
  const valor = parseFloat(document.getElementById('valor').value);
  const tipo = document.getElementById('tipo').value;
  
  if (!data || !descricao || !categoria || isNaN(valor) || valor <= 0) {
    showNotification('Preencha todos os campos corretamente', false);
    return;
  }
  
  try {
    if (tipo === 'despesa' && parcelasGroup.classList.contains('show')) {
      const numParcelas = parseInt(document.getElementById('parcelas').value) || 1;
      const intervalo = parseInt(document.getElementById('intervalo').value) || 30;
      
      for (let i = 0; i < numParcelas; i++) {
        const dataParcela = new Date(data);
        dataParcela.setDate(dataParcela.getDate() + (i * intervalo));
        
        const parcelaData = {
          data: dataParcela.toISOString().split('T')[0],
          descricao: `${descricao} (Parcela ${i+1}/${numParcelas})`,
          categoria,
          valor: (valor / numParcelas).toFixed(2),
          tipo,
          parcelaAtual: i+1,
          totalParcelas: numParcelas
        };
        
        await push(transacoesRef, parcelaData);
      }
    } else {
      await push(transacoesRef, { data, descricao, categoria, valor, tipo });
    }
    
    document.getElementById('form-transacao').reset();
    hideForm();
    showNotification('Transa√ß√£o adicionada com sucesso!');
  } catch (error) {
    showNotification('Erro ao adicionar transa√ß√£o', false);
  }
});

// Gerar PDF do m√™s
function gerarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  
  const hoje = new Date();
  const mesAtual = hoje.toLocaleString('pt-BR', { month: 'long', year: 'numeric' });
  doc.setFontSize(20);
  doc.text(`Relat√≥rio Financeiro - ${mesAtual}`, 105, 15, { align: 'center' });
  
  const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
  const ultimoDiaMes = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
  
  const transacoesMes = todasTransacoes.filter(t => {
    const dataTransacao = new Date(t.data);
    return dataTransacao >= primeiroDiaMes && dataTransacao <= ultimoDiaMes;
  });
  
  const receitasMes = transacoesMes
    .filter(t => t.tipo === 'receita')
    .reduce((total, t) => total + parseFloat(t.valor), 0);
    
  const despesasMes = transacoesMes
    .filter(t => t.tipo === 'despesa')
    .reduce((total, t) => total + parseFloat(t.valor), 0);
    
  const saldoMes = receitasMes - despesasMes;
  
  doc.setFontSize(14);
  doc.text('Resumo do M√™s', 14, 30);
  
  doc.setFontSize(12);
  doc.text(`Receitas: ${receitasMes.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'})}`, 20, 40);
  doc.text(`Despesas: ${despesasMes.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'})}`, 20, 50);
  doc.text(`Saldo: ${saldoMes.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'})}`, 20, 60);
  
  if (transacoesMes.length > 0) {
    doc.setFontSize(14);
    doc.text('Transa√ß√µes do M√™s', 14, 80);
    
    const tableColumn = ["Data", "Descri√ß√£o", "Valor"];
    const tableRows = [];
    
    transacoesMes.sort((a, b) => new Date(b.data) - new Date(a.data))
      .forEach(t => {
        const dataFormat = new Date(t.data).toLocaleDateString('pt-BR');
        const valorFormat = parseFloat(t.valor).toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'});
        const valorComSinal = t.tipo === 'receita' ? valorFormat : `-${valorFormat}`;
        
        tableRows.push([dataFormat, t.descricao, valorComSinal]);
      });
    
    doc.autoTable({
      head: [tableColumn],
      body: tableRows,
      startY: 90,
      theme: 'grid',
      styles: { fontSize: 10 },
      headStyles: { fillColor: [67, 97, 238] }
    });
  } else {
    doc.text('Nenhuma transa√ß√£o encontrada para este m√™s.', 14, 90);
  }
  
  doc.save(`relatorio-financeiro-${mesAtual}.pdf`);
  showNotification('PDF gerado com sucesso!');
}

// Preencher data atual por padr√£o
document.getElementById('data').valueAsDate = new Date();

// Inicializar verifica√ß√µes de atualiza√ß√£o
verificarAtualizacaoDiaria();
</script>
</body>
</html>


    
